


//###############################################################################################
// ********************************* KaranlÄ±k Ekran DÃ¼zelt BAÅ **********************************
//###############################################################################################



function sayfayiDinle() {
    let observer = new MutationObserver(() => {
        let panel = document.getElementById("mainPreviewForm:onizlemePanel");
        let btn = document.getElementById("karanlik-duzelt-btn");

        // EÄŸer ID varsa ve buton yoksa, butonu ekle
        if (panel && !btn) {
            karanlikDuzeltButonuEkle();
        }

        // EÄŸer ID sayfadan kaybolursa butonu da kaldÄ±r
        if (!panel && btn) {
            btn.remove();
        }
    });

    observer.observe(document.body, { childList: true, subtree: true });

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda ilgili Ã¶ÄŸe zaten varsa butonu ekle
    if (document.getElementById("mainPreviewForm:onizlemePanel")) {
        karanlikDuzeltButonuEkle();
    }
}

function karanlikDuzeltButonuEkle() {
    let btn = document.createElement("button");
    btn.id = "karanlik-duzelt-btn";
    btn.innerHTML = "<span style='font-size: 25px; margin-bottom:4px;'>ğŸŒ™</span>";// BaÅŸlangÄ±Ã§ta sadece ikon gÃ¶rÃ¼nsÃ¼n
    btn.style = `
        width: 35px; height: 35px;
        background: rgba(224, 236, 252, 0);
        color: white; border: none; border-radius: 100%;
        cursor: pointer; font-size: 14px;
        z-index: 10000; margin:3px 12px 3px 12px;
        transition: all 0.4s ease-in-out;
        overflow: hidden; white-space: nowrap;
        display: flex; align-items: center; justify-content: center;
    `;


    // background: linear-gradient(135deg, #007AFF, #005BBB);

    // Hover efekti (buton geniÅŸliyor, yazÄ± beliriyor)
    btn.onmouseover = function () {
        btn.style.width = "196px";
        btn.style.background= "linear-gradient(135deg, #007AFF, #005BBB)";
        btn.innerHTML = "ğŸŒ™ &nbsp; KaranlÄ±k Modu DÃ¼zelt";
        btn.style.justifyContent = "flex-start";
        btn.style.paddingLeft = "15px";
    };
    btn.onmouseleave = function () {
        btn.style.width = "35px";
        btn.style.background="rgba(224, 236, 252, 0)";
        btn.innerHTML = "<span style='font-size: 25px; margin-bottom:4px;'>ğŸŒ™</span>";
        btn.style.justifyContent = "center";
        btn.style.paddingLeft = "0px";
    };

    btn.onclick = function () {
        showNotification("ğŸ”„ KaranlÄ±k ekran sorunu Ã§Ã¶zÃ¼lÃ¼yor...", "info");
        setTimeout(() => {
            location.reload(true); // SayfayÄ± Ctrl + F5 gibi yenile
        }, 1500);
    };

    // ğŸ“Œ Ä°lk buton menÃ¼sÃ¼nÃ¼ bul ve en Ã¶ne ekle (Body'ye eklemiyor!)
    let firstMenuButton = document.querySelector(".buttonMenuContainerDefault");
    if (firstMenuButton) {
        firstMenuButton.parentNode.insertBefore(btn, firstMenuButton);
    }
}

// ğŸ“Œ Bildirim Sistemi
function showNotification(message, type = "success") {
    let notification = document.createElement("div");
    notification.innerText = message;
    notification.style = `
        position: fixed; top: 15px; right: 15px;
        background: ${type === "success" ? "#4CAF50" : type === "error" ? "#FF5733" : "#007AFF"};
        color: white; padding: 12px 20px;
        border-radius: 8px; font-size: 14px; font-weight: bold;
        z-index: 10001; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        opacity: 1; transition: opacity 0.5s ease-in-out;
    `;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = "0";
        setTimeout(() => document.body.removeChild(notification), 500);
    }, 3000);
}

// **Sayfa yÃ¼klenince butonu kontrol et ve ekle**
sayfayiDinle();


//###############################################################################################
// ********************************** KaranlÄ±k Ekran DÃ¼zelt SON**********************************
//###############################################################################################





//###############################################################################################
// ************************************ Evrak Ekle Ä°sim BAÅ *************************************
//###############################################################################################


(function() {
    'use strict';

    const labelID = "windowCevapEvrakForm:evrakEkTabView:dosyaAdi";      // Label ID
    const textareaID = "windowCevapEvrakForm:evrakEkTabView:dosyaAciklama"; // Textarea ID

    let textarea = document.getElementById(textareaID);
    let label = document.getElementById(labelID);

    // KullanÄ±cÄ±nÄ±n textarea'ya mÃ¼dahale edip etmediÄŸini kontrol etmek iÃ§in bayrak
    let userModified = false;

    if (textarea) {
        textarea.addEventListener('input', function() {
            userModified = true; // KullanÄ±cÄ± bir ÅŸey yazarsa artÄ±k otomatik gÃ¼ncelleme yapÄ±lmaz
        });
    }

    function updateTextarea() {
        let label = document.getElementById(labelID);
        let textarea = document.getElementById(textareaID);

        if (label && textarea && !userModified) {
            let labelText = label.textContent.trim();
            if (labelText && textarea.value.trim() === "") {
                textarea.value = labelText;
            }
        }
    }

    // DOM deÄŸiÅŸikliklerini izleyen MutationObserver kullanarak sayfadaki deÄŸiÅŸiklikleri takip et
    const observer = new MutationObserver(updateTextarea);
    const config = { childList: true, subtree: true, characterData: true };

    let labelElement = document.getElementById(labelID);
    if (labelElement) {
        observer.observe(labelElement, config);
    }

    // Belirli aralÄ±klarla gÃ¼ncelleme yap
    setInterval(updateTextarea, 1000);
})();

//###############################################################################################
// ************************************ Evrak Ekle Ä°sim SON *************************************
//###############################################################################################




//###############################################################################################
// ******************************* Evrak Ekle Ä°sim Taslak BAÅ ***********************************
//###############################################################################################
(function() {
    'use strict';

    const labelID = "inboxItemInfoForm:evrakEkTabView:dosyaAdi";      // Label ID
    const textareaID = "inboxItemInfoForm:evrakEkTabView:dosyaAciklama"; // Textarea ID

    let textarea = document.getElementById(textareaID);
    let label = document.getElementById(labelID);

    // KullanÄ±cÄ±nÄ±n textarea'ya mÃ¼dahale edip etmediÄŸini kontrol etmek iÃ§in bayrak
    let userModified = false;

    if (textarea) {
        textarea.addEventListener('input', function() {
            userModified = true; // KullanÄ±cÄ± bir ÅŸey yazarsa artÄ±k otomatik gÃ¼ncelleme yapÄ±lmaz
        });
    }

    function updateTextarea() {
        let label = document.getElementById(labelID);
        let textarea = document.getElementById(textareaID);

        if (label && textarea && !userModified) {
            let labelText = label.textContent.trim();
            if (labelText && textarea.value.trim() === "") {
                textarea.value = labelText;
            }
        }
    }

    // DOM deÄŸiÅŸikliklerini izleyen MutationObserver kullanarak sayfadaki deÄŸiÅŸiklikleri takip et
    const observer = new MutationObserver(updateTextarea);
    const config = { childList: true, subtree: true, characterData: true };

    let labelElement = document.getElementById(labelID);
    if (labelElement) {
        observer.observe(labelElement, config);
    }

    // Belirli aralÄ±klarla gÃ¼ncelleme yap
    setInterval(updateTextarea, 1000);
})();

//###############################################################################################
// ************************************ Evrak Ekle Ä°sim Son *************************************
//###############################################################################################







//###############################################################################################
// ************************ Otomatik GiriÅŸ - KEP GiriÅŸ - E-Ä°mza BAÅLA **************************
//###############################################################################################

(function() {
    'use strict';

    let isClicked = false;  // Kep Butonun tÄ±klanma durumunu kontrol eden bayrak
    let isClicked_g = false; // GiriÅŸ Butonun tÄ±klanma durumunu kontrol eden bayrak








      //****************************************************************************************
     //****************************************   Sticky Menu BAÅ   **************************************
    //******************************************************************************************


    // ğŸ“Œ localStorage ile veri saklama
function getValue(key, defaultValue) {
    return localStorage.getItem(key) || defaultValue;
}

function setValue(key, value) {
    localStorage.setItem(key, value);
}


// ğŸ“Œ Åifre gÃ¼ncelleme kontrolÃ¼
window.onload = function () {
    let sifreGuncellemeDurumu = getValue("sifreGuncellemeDurumu", "0");

    if (sifreGuncellemeDurumu === "0") {
        acDialog("Yeni KullanÄ±cÄ± AdÄ± Girin", "KullanÄ±cÄ± AdÄ±", "", (newKullaniciAdi) => {
            setValue("kullanici_adi", newKullaniciAdi);
            showNotification("KullanÄ±cÄ± adÄ± gÃ¼ncellendi!");

            acDialog("Yeni Åifreyi Girin", "Åifre", "", (newSifre) => {
                setValue("sifre", newSifre);
                showNotification("Åifre gÃ¼ncellendi!");

                acDialog("Yeni e-Ä°mza PIN Girin", "e-Ä°mza PIN", "", (newEimza) => {
                    setValue("e_imza", newEimza);
                    showNotification("e-Ä°mza PIN gÃ¼ncellendi!");

                    acDialog("Yeni KEP Parola Girin", "KEP Parola", "", (newKepParola) => {
                        setValue("kep_parola", newKepParola);
                        showNotification("KEP Parola gÃ¼ncellendi!");

                        acDialog("Yeni KEP Åifre Girin", "KEP Åifre", "", (newKepSifre) => {
                            setValue("kep_sifre", newKepSifre);
                            showNotification("KEP Åifre gÃ¼ncellendi!");




                            // **TÃ¼m giriÅŸler tamamlandÄ±, ÅŸimdi sifreGuncellemeDurumu = "1" yap**
                            setValue("sifreGuncellemeDurumu", "1");

                            // **SayfayÄ± yenileyerek yeni deÄŸerleri yÃ¼kle**
                            setTimeout(() => location.reload(), 2000);
                        });
                    });
                });
            });
        });
    }
};




// ğŸ“Œ KullanÄ±cÄ± bilgileri (VarsayÄ±lan deÄŸerler)
let kullanici_adi = getValue("kullanici_adi", "A");
let sifre = getValue("sifre", "A");
let e_imza = getValue("e_imza", "");
let kep_parola = getValue("kep_parola", "");
let kep_sifre = getValue("kep_sifre", "");

// ğŸ“Œ Bildirim Sistemi
function showNotification(message, type = "success") {
    let notification = document.createElement("div");
    notification.innerText = message;
    notification.style = `
        position: fixed; top: 10px; right: 10px; padding: 10px 20px;
        border-radius: 5px; font-size: 14px; font-weight: bold;
        background: ${type === "success" ? "#4CAF50" : "#FF5733"};
        color: white; z-index: 10000; transition: opacity 0.5s;
    `;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = "0";
        setTimeout(() => document.body.removeChild(notification), 500);
    }, 3000);
}









function acDialog(baslik, placeholder, mevcutDeger, callback) {
    // ğŸ“Œ **TÃ¼m arka plan inputlarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak**
    let allInputs = document.querySelectorAll("input, textarea, select");
    allInputs.forEach(input => input.disabled = true);

    let modalBackground = document.createElement("div");
    modalBackground.style = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.5); z-index: 9999;
        display: flex; align-items: center; justify-content: center;
    `;

    let modal = document.createElement("div");
    modal.style = `
        background: white; padding: 20px; border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3); text-align: center;
        width: 300px;
    `;

    let title = document.createElement("div");
    title.innerText = baslik;
    title.style = "font-size: 16px; font-weight: bold; margin-bottom: 10px;";
    modal.appendChild(title);

    let input = document.createElement("input");
    input.type = placeholder.toLowerCase().includes("*") ? "password" : "text";
    input.placeholder = placeholder;
    input.value = mevcutDeger || "";

    // ğŸ“Œ **TarayÄ±cÄ±nÄ±n otomatik doldurmasÄ±nÄ± tamamen kapat**
    input.setAttribute("autocomplete", "off");
    input.setAttribute("autocorrect", "off");
    input.setAttribute("autocapitalize", "off");
    input.setAttribute("spellcheck", "false");

    input.style = `
        padding: 8px; width: 90%; margin-bottom: 10px;
        border: 1px solid #ccc; border-radius: 5px; text-align: center;
    `;
    modal.appendChild(input);

    let buttonContainer = document.createElement("div");
    buttonContainer.style = "display: flex; justify-content: space-between; margin-top: 10px;";

    let confirmButton = document.createElement("button");
    confirmButton.innerText = "Onayla";
    confirmButton.style = `
        padding: 8px 15px; background: #4CAF50; color: white;
        border: none; border-radius: 5px; cursor: pointer;
        width: 45%;
    `;
    confirmButton.onclick = function () {
        if (input.value.trim() !== "") {
            document.body.removeChild(modalBackground);

            // ğŸ“Œ **Arka plan inputlarÄ±nÄ± tekrar aktif et**
            allInputs.forEach(input => input.disabled = false);

            callback(input.value.trim());
        } else {
            showNotification("BoÅŸ bÄ±rakÄ±lamaz!", "error");
        }
    };

    let cancelButton = document.createElement("button");
    cancelButton.innerText = "VazgeÃ§";
    cancelButton.style = `
        padding: 8px 15px; background: #FF5733; color: white;
        border: none; border-radius: 5px; cursor: pointer;
        width: 45%;
    `;
    cancelButton.onclick = function () {
        document.body.removeChild(modalBackground);

        // ğŸ“Œ **Arka plan inputlarÄ±nÄ± tekrar aktif et**
        allInputs.forEach(input => input.disabled = false);

        showNotification("Ä°ÅŸlem iptal edildi.", "error");
    };

    buttonContainer.appendChild(cancelButton);
    buttonContainer.appendChild(confirmButton);
    modal.appendChild(buttonContainer);
    modalBackground.appendChild(modal);
    document.body.appendChild(modalBackground);

    // ğŸ“Œ **Input otomatik seÃ§ilsin ve odaklansÄ±n**
    setTimeout(() => {
        input.focus();
        input.select();
    }, 10);
}






// ğŸ“Œ Sticky MenÃ¼ oluÅŸtur
let menuContainer = document.createElement("div");
menuContainer.id = "ebys-plus-menu";
menuContainer.style = `
    position: fixed; top: 5px; left: 5px;
    background: rgba(0, 0, 0, 0.7); color: white;
    padding: 15px; border-radius: 5px;
    z-index: 9999; width: 210px; display: none;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
`;

// BaÅŸlÄ±k
let baslik = document.createElement("div");
baslik.innerText = "âš™ï¸ EBYS Plus";
baslik.style = "font-weight: bold; text-align: center; font-size: 18px; margin-bottom: 10px;";
menuContainer.appendChild(baslik);

// ğŸ“Œ Åifre doÄŸrulama fonksiyonu
function sifreDogrulama(callback) {
    acDialog("Åifre DoÄŸrulama", "* Ebys Åifre DoÄŸrula *", "", (inputSifre) => {
        if (inputSifre === sifre) {
            callback();
        } else {
            showNotification("HatalÄ± ÅŸifre!", "error");
        }
    });
}

// ğŸ“Œ GÃ¼ncelleme butonlarÄ±na doÄŸrulama ekleme
function addButton(text, key, variable) {
    let btn = document.createElement("button");
    btn.innerText = text;
    btn.style = `
        display: block; padding: 7px; width: 90%;
        margin: 5px auto; border: none; cursor: pointer;
        border-radius: 5px; background: #4CAF50; color: white;
    `;

    btn.onclick = function() {
        sifreDogrulama(() => {
            acDialog(`Yeni ${text}`, text, variable, (newValue) => {
                setValue(key, newValue);
                showNotification(`${text} gÃ¼ncellendi!`);
                location.reload();
            });
        });
    };
    menuContainer.appendChild(btn);
}

addButton("KullanÄ±cÄ± AdÄ± DeÄŸiÅŸtir", "kullanici_adi", kullanici_adi);
addButton("Åifreyi DeÄŸiÅŸtir", "sifre", sifre);
addButton("E-Ä°mza PIN DeÄŸiÅŸtir", "e_imza", e_imza);
addButton("KEP Parola DeÄŸiÅŸtir", "kep_parola", kep_parola);
addButton("KEP Åifre DeÄŸiÅŸtir", "kep_sifre", kep_sifre);

let updateAllBtn = document.createElement("button");
updateAllBtn.innerText = "ğŸ”’ TÃ¼m Åifreleri GÃ¼ncelle";
updateAllBtn.style = `
    display: block; padding: 7px; width: 90%;
    margin: 10px auto; border: none; cursor: pointer;
    border-radius: 5px; background: #FF5733; color: white;
`;

updateAllBtn.onclick = function() {
    sifreDogrulama(() => {
        acDialog("Yeni KullanÄ±cÄ± AdÄ± Girin", "KullanÄ±cÄ± AdÄ±", kullanici_adi, (newKullaniciAdi) => {
            setValue("kullanici_adi", newKullaniciAdi);
            showNotification("KullanÄ±cÄ± adÄ± gÃ¼ncellendi!");

            acDialog("Yeni Åifreyi Girin", "Åifre", sifre, (newSifre) => {
                setValue("sifre", newSifre);
                showNotification("Åifre gÃ¼ncellendi!");



                acDialog("Yeni e_imza Girin", "e_imza", e_imza, (neweimza) => {
                    setValue("e_imza", neweimza);
                    showNotification("Åifre gÃ¼ncellendi!");


                acDialog("Yeni kep_parola Girin", "kep_parola", kep_parola, (newkepparola) => {
                    setValue("kep_parola", newkepparola);
                    showNotification("Åifre gÃ¼ncellendi!");



                acDialog("Yeni kep_sifre Girin", "kep_sifre", kep_sifre, (newkepsifre) => {
                    setValue("kep_sifre", newkepsifre);
                    showNotification("Åifre gÃ¼ncellendi!");
                    location.reload();

                        });
                    });
                });
            });
        });
    });

};

menuContainer.appendChild(updateAllBtn);
document.body.appendChild(menuContainer);

let toggleButton = document.createElement("button");
toggleButton.innerText = "âš™ï¸ EBYS Plus MenÃ¼";
toggleButton.style = `
    position: fixed; top: 4px; left: 248px;
    z-index: 10000; padding: 6px 10px 8px 10px;
    background: rgb(28, 120, 171); color: white;
    border: none; border-radius: 5px; cursor: pointer;
`;
toggleButton.onclick = function() {
    let menu = document.getElementById("ebys-plus-menu");
    menu.style.display = menu.style.display === "none" ? "block" : "none";
};
document.body.appendChild(toggleButton);


      //**************************************************************************************************
     //****************************************   Sticky Menu SON   **************************************
    //****************************************************************************************************




     // Bu fonksiyon input alanÄ±nÄ± bulur ve deÄŸerini insansÄ± ÅŸekilde ayarlar
    function simulateTyping(inputElement, text) {
        inputElement.focus();
        inputElement.value = '';

        for (let i = 0; i < text.length; i++) {
            let char = text[i];
            let keydownEvent = new KeyboardEvent('keydown', { key: char, bubbles: true });
            inputElement.dispatchEvent(keydownEvent);

            inputElement.value += char;  // Åifreyi karakter karakter yaz
            let keyupEvent = new KeyboardEvent('keyup', { key: char, bubbles: true });
            inputElement.dispatchEvent(keyupEvent);
        }

        inputElement.dispatchEvent(new Event('input', { bubbles: true }));
        inputElement.dispatchEvent(new Event('change', { bubbles: true }));
    }


    // Fonksiyon BaÅŸlangÄ±Ã§
    function setPasswordValue() {


        // E-imza BaÅŸlangÄ±Ã§
        const input_3 = document.getElementById('txtPinKod');
        if (input_3 && input_3.value !== e_imza) {
            simulateTyping(input_3, e_imza);
        }
        // E-imza Son




        // Kep KÄ±smÄ± BaÅŸlangÄ±Ã§
        const input = document.getElementById('passwordParola');
        if (input && input.value !== kep_parola) {
            simulateTyping(input, kep_parola);
        }

        const input_2 = document.getElementById('passwordSifre');
        if (input_2 && input_2.value !== kep_sifre) {
            simulateTyping(input_2, kep_sifre);
        }


        // GiriÅŸ butonuna bir kere tÄ±klayÄ±n ve sonra durun
        if (!isClicked) {
            const loginButton = document.querySelector('button[id="kepLogin2FormId:j_idt385"]');
            if (loginButton) {
                loginButton.click();
                isClicked = true;  // TÄ±klama tamamlandÄ±ÄŸÄ±nda bayraÄŸÄ± gÃ¼ncelle
            }
        }
        // Kep KÄ±smÄ± Son




        //Ebys GiriÅŸ BaÅŸlangÄ±Ã§

    // EÄŸer zaten giriÅŸ yapÄ±ldÄ±ysa script Ã§alÄ±ÅŸmasÄ±n
    if (document.querySelector('.logout') || document.body.innerText.includes('HoÅŸgeldiniz')) {
        return;
    }


        // KullanÄ±cÄ± adÄ± ve ÅŸifreyi klavye simÃ¼lasyonu ile doldurun
        let usernameField = document.querySelector('input[name="parolaSertifikaAccordion:uForm:txtUKullaniciAdi"]');
        simulateTyping(usernameField, kullanici_adi); // KullanÄ±cÄ± adÄ±nÄ±zÄ± yazÄ±n

        let passwordField = document.querySelector('input[id="loginUSifre"]');
        simulateTyping(passwordField, sifre); // Åifrenizi yazÄ±n



        // GiriÅŸ butonuna bir kere tÄ±klayÄ±n ve sonra durun
        if (!isClicked_g) {
            const loginButton_g =  document.querySelector('button[type="submit"]');
            if (loginButton_g) {
                loginButton_g.click();
                isClicked_g = true;  // TÄ±klama tamamlandÄ±ÄŸÄ±nda bayraÄŸÄ± gÃ¼ncelle
            }
        }



        //Ebys GiriÅŸ Son



    }
// Fonksiyon Son





    // Dinamik olarak sayfa yÃ¼klendikÃ§e kontrol etmek iÃ§in MutationObserver kullanÄ±yoruz
    const observer = new MutationObserver(() => {
        setPasswordValue();
    });

    // Sayfa iÃ§eriÄŸini izlemek iÃ§in yapÄ±landÄ±rma
    observer.observe(document.body, { childList: true, subtree: true });

    // BaÅŸlangÄ±Ã§ta hemen kontrol et
    setPasswordValue();
})();

//###############################################################################################
// ************************ Otomatik GiriÅŸ - KEP GiriÅŸ - E-Ä°mza SON *****************************
//###############################################################################################











